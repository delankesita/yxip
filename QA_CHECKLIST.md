QA 清单与发布前检查流程

一、核心功能验证

- 数据源可访问：脚本可成功请求各 URL，网络异常时可容错并写入日志。
- 解析结果正确：
  - 能从 HTML 文本中提取有效 IPv4 地址。
  - 去重逻辑生效，重复来源不会产生重复 IP。
- 文件写入安全：
  - ip.txt 采用原子写（先写临时文件再覆盖），避免并发或中断造成的部分写入。
- 审计日志完整：
  - 记录开始、每个 URL 抓取、解析数量、异常信息、最终汇总、写入完成等关键事件。
  - 使用 scripts/audit_viewer.py 支持按 level/关键词筛查。

二、自动化测试

- 单元测试：pytest 通过，覆盖率保持或提升（参考 CI 产物 coverage.xml）。
- 端到端：在临时目录运行 main，生成 ip.txt 与 audit.log，并校验关键日志行。

三、CI/CD

- GitHub Actions 成功执行 test 流水线：
  - 安装依赖
  - 运行 pytest 并生成覆盖率工件
- 定时任务工作流（main.yml）在变更时自动提交 ip.txt。

四、发布前检查（手动）

- 查看最新审计日志，确认没有连续失败；必要时临时增加日志级别或关键词过滤定位问题。
- 随机抽样验证 ip.txt 中 IP 格式合法（四段 0-255）。
- 如需调整数据源：通过 CF_URLS 环境变量在本地验证后，再提交改动。

五、回滚预案

- 如脚本变更导致异常，可快速回退到上一个成功版本；CI 工件提供的测试与覆盖率用于快速定位问题。
